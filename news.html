<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News</title>
    <link rel="stylesheet" href="news.css">

</head>
<body>
    <div class="navbar">
        <a href="home.html"><b>Rent-A-Car02</b></a>
        <a href="home.html">Home</a>
        <a href="main.html">Rentals</a>
        <a href="aboutus.html">About Us</a>
        <a href="contactus.html">Contact Us</a>
        <a href="news.html" class="current-page">News</a>
        <a href="logout.php">Logout</a>
    </div>
    <iframe src="slider.html" width="100%" height="500px" style="border: none;"></iframe>

    <h2>Menaxhimi i Veturave</h2>
<input type="hidden" id="editId">
<input type="text" id="carName" placeholder="Modeli i Veturës">
<input type="text" id="carBrand" placeholder="Marka">
<input type="number" id="carYear" placeholder="Viti i Prodhimit">
<input type="number" id="carPrice" placeholder="Çmimi i Qirasë">
<select id="carStatus">
    <option value="disponueshme">Disponueshme</option>
    <option value="e rezervuar">E rezervuar</option>
    <option value="ne mirembajtje">Në mirëmbajtje</option>
</select>
<button onclick="createCar()">Shto Veturen</button>
<button onclick="updateCar()" id="updateBtn" style="display:none;">Përditëso Veturen</button>
<script>
    function fetchCars() {
    fetch("fetch.php")
        .then(response => response.json())
        .then(data => {
            const carTable = document.getElementById("carTable");
            carTable.innerHTML = "";
            data.forEach(car => {
                carTable.innerHTML += `
                    <tr>
                        <td>${car.emri}</td>
                        <td>${car.marka}</td>
                        <td>${car.viti}</td>
                        <td>${car.cmimi} €</td>
                        <td>${car.statusi}</td>
                        <td>
                            <button onclick="setEditCar(${car.id}, '${car.emri}', '${car.marka}', ${car.viti}, ${car.cmimi}, '${car.statusi}')">Edito</button>
                            <button onclick="deleteCar(${car.id})">Fshi</button>
                        </td>
                    </tr>
                `;
            });
        })
        .catch(error => console.error('Gabim gjatë marrjes së të dhënave:', error));
}

function createCar() {
    const name = document.getElementById("carName").value.trim();
    const brand = document.getElementById("carBrand").value.trim();
    const year = document.getElementById("carYear").value;
    const price = document.getElementById("carPrice").value;
    const status = document.getElementById("carStatus").value;
    
    if (!name || !brand || !year || !price || !status) {
        alert("Please fill in all fields!");
        return;
    }

    fetch("insert.php", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: `name=${encodeURIComponent(name)}&brand=${encodeURIComponent(brand)}&year=${encodeURIComponent(year)}&price=${encodeURIComponent(price)}&status=${encodeURIComponent(status)}`
    })
    .then(() => {
        fetchCars();
        document.getElementById("carName").value = "";
        document.getElementById("carBrand").value = "";
        document.getElementById("carYear").value = "";
        document.getElementById("carPrice").value = "";
        document.getElementById("carStatus").value = "disponueshme";
    })
    .catch(error => console.error('Error while adding vehicle:', error));
}

function setEditCar(id, name, brand, year, price, status) {
    document.getElementById("carName").value = name;
    document.getElementById("carBrand").value = brand;
    document.getElementById("carYear").value = year;
    document.getElementById("carPrice").value = price;
    document.getElementById("carStatus").value = status;
    document.getElementById("editId").value = id;
    document.getElementById("updateBtn").style.display = "inline"; 
}

function updateCar() {
    const id = document.getElementById("editId").value;
    const name = document.getElementById("carName").value.trim();
    const brand = document.getElementById("carBrand").value.trim();
    const year = document.getElementById("carYear").value;
    const price = document.getElementById("carPrice").value;
    const status = document.getElementById("carStatus").value;

    if (!id || !name || !brand || !year || !price || !status) {
        alert("Ju lutem plotësoni të gjitha fushat për përditësim!");
        return;
    }

    fetch("update.php", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: `id=${encodeURIComponent(id)}&name=${encodeURIComponent(name)}&brand=${encodeURIComponent(brand)}&year=${encodeURIComponent(year)}&price=${encodeURIComponent(price)}&status=${encodeURIComponent(status)}`
    })
    .then(() => {
        fetchCars();
        document.getElementById("editId").value = "";
        document.getElementById("carName").value = "";
        document.getElementById("carBrand").value = "";
        document.getElementById("carYear").value = "";
        document.getElementById("carPrice").value = "";
        document.getElementById("carStatus").value = "disponueshme";
        document.getElementById("updateBtn").style.display = "none"; 
    })
    .catch(error => console.error('Error while updating the vehicle:', error));
}

function deleteCar(id) {
    if (confirm("Are you sure you want to delete this car?")) {
        fetch("delete.php", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: `id=${encodeURIComponent(id)}`
        })
        .then(() => fetchCars())
        .catch(error => console.error('Error while deleting the vehicle:', error));
    }
}

fetchCars();
</script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f4f4f4; }
    </style>
</head>
<body>
    <h2>Menaxhimi i Përdoruesve</h2>
    <input type="text" id="name" placeholder="Emri">
    <input type="email" id="email" placeholder="Email">
    <button onclick="createUser()">Shto Përdorues</button>
    
    <table>
        <thead>
            <tr>
                <th>Emri</th>
                <th>Email</th>
                <th>Veprime</th>
            </tr>
        </thead>
        <tbody id="userTable"></tbody>
    </table>
    <script>
        let users = JSON.parse(localStorage.getItem("users")) || [];
        
        function renderUsers() {
            const userTable = document.getElementById("userTable");
            userTable.innerHTML = "";
            users.forEach((user, index) => {
                userTable.innerHTML += `
                    <tr>
                        <td>${user.name}</td>
                        <td>${user.email}</td>
                        <td>
                            <button onclick="editUser(${index})">Edito</button>
                            <button onclick="deleteUser(${index})">Fshi</button>
                        </td>
                    </tr>
                `;
            });
            localStorage.setItem("users", JSON.stringify(users));
        }
        
        function createUser() {
            const name = document.getElementById("name").value;
            const email = document.getElementById("email").value;
            if (name && email) {
                users.push({ name, email });
                renderUsers();
                document.getElementById("name").value = "";
                document.getElementById("email").value = "";
            }
        }
        
        function editUser(index) {
            const newName = prompt("Write the new name", users[index].name);
            const newEmail = prompt("Write the new email", users[index].email);
            if (newName && newEmail) {
                users[index] = { name: newName, email: newEmail };
                renderUsers();
            }
        }
        
        function deleteUser(index) {
            if (confirm("Are you sure you want to delete this user?")) {
                users.splice(index, 1);
                renderUsers();
            }
        }
        
        renderUsers();
    </script>

</body>
</html>
